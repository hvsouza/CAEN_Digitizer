#+STARTUP: inlineimages
#+STARTUP: showeverything

* CAEN DIGITIZER 
Author: Henrique Vieira de Souza, APC – Paris

henriquevieira.souza@gmail.com 


* Table of Contents
  :PROPERTIES:
  :TOC:      :include all
  :END:
:CONTENTS:
- [[#caen-digitizer][CAEN DIGITIZER]]
- [[#table-of-contents][Table of Contents]]
- [[#introduction][Introduction]]
- [[#wavedump][Wavedump]]
  - [[#installation][Installation]]
  - [[#configuration-file][Configuration file]]
  - [[#using-wavedump][Using wavedump]]
  - [[#debugging-usb][Debugging USB]]
- [[#qtcreator-gui][QtCreator GUI]]
  - [[#installation][Installation]]
  - [[#creating-the-project][Creating the project]]
  - [[#debugging-installation][Debugging installation]]
  - [[#using-the-gui][Using the GUI]]
- [[#extra-creating-a-shortcut-for-wavedump][Extra: Creating a shortcut for Wavedump]]
- [[#extra-wavedump-decreased-sampling][Extra: Wavedump decreased sampling]]
- [[#extra-common-variables][Extra: Common variables]]
- [[#extra-file-structure][Extra: File structure]]
:END:



* Introduction 
This documents servers do clarify and help the data acquisition with the CAEN digitizer. All the softwares and drivers are availabe at [[http:://caen.it][caen.it]]. 

The acquisition is done with Wavedump, a free software distributed by CAEN. The versions modified by the me have two minor implementations: (1) continuous writing will save only 10,000 waveforms and stop and (2) one can change the number of points per waveform saved, this decreases the sampling rate from 2 ns to 4 ns, for example, by skipping one point.

Please, keep in mind that the implementation (2) will not reduce the acquisition rate of the digitizer, just of the saved waveforms. 

Wavedump will only save data in a file named wave0.dat when saving as BINARY (or wave0.txt when saving as ASCII). I am assuming you have wisely chosen binary as format. 
Wave0.dat refers to the waveforms of channel 0, while wave1.dat refers to channel 1.

If you want to save several .dat data files you need to move these waveX.dat files to another folder before saving new ones. As this task can be very tedious,  I’ve created a GUI with QtCreator to transfer the files and menage data taking more efficiently. The GUI is not mandatory, it should just make your life easier! 

Please, make sure you have “make” and “cmake” installed. The software “gnuplot” is also necessary but it will be installed in the installation scripts.
Please, if you find any bug, miss information or some nasty mistake, please feel free to talk to me by email.


* Wavedump

** Installation
   Clone this repositiory inside the "Documents" folder:
   #+begin_src bash
   cd ~/Desktop/test
   git clone https://github.com/hvsouza/CAEN_Digitizer.git
   cd CAEN_Digitizer
   #+end_src

   To install the digitizer drivers and wavedump there are a few requirements and steps. I invite the user to read the manual of the digitizer and wavedump and also to search about the installation.
   
   There is a script named “caen_installation.sh”. The script will install the required softwares and drivers and applied the changes to customize to the version created by me. As this is done in a single step, there will be 3 seconds to check for errors output. If you see any, please, try to fix it before installing everything. NOTE: you need to disable “Secure Boot” at the BIOS.
   
   #+begin_src bash
   ./caen_installation.sh
   #+end_src
   
   If you are installing for the first time, you probably need to restart the computer. 
   If the digitizer is connected and installation was successfully, open a terminal and just type “wavedump”, it should show you something like this output:

      [[https://github.com/hvsouza/CAEN_Digitizer/blob/master/.repo_img/startup_ex.png]]

   The script has also created the folder: =~/Desktop/WaveDumpData=. To use the GUI, you need to execute wavedump while inside that folder, so wavedump will save the data there 
  
   There are other customizations you can do, you can take a look at [[#extra-creating-a-shortcut-for-wavedump]]

   If you want to enable the option to decrease wavedump writing sample rate, please look at [[#extra-wavedump-decreased-sampling]]

** Configuration file

   Please, refer to the wavedump manual to better understand the acquisition configuration.

   The configuration file of wavedump is located at =/etc/wavedump/WaveDumpConfig.txt=.
   If you cd in the WaveDumpData folder =cd ~/Desktop/WaveDumpData= and execute =./WaveDumpExe.sh=, the configuration file should open together with wavedump.

   The current important parameters to take care are reported at [[#extra-common-variables]].

** Using wavedump

   Using wavedump is quite simple, just type =wavedump= at the terminal. By pressing [SPACE] the help menu is printed as bellow. Please keep in mind that [T] means “shift + t key”.

   [[https://github.com/hvsouza/CAEN_Digitizer/blob/master/.repo_img/help_ex.png]]

The ones you will use most are:
   [R]
   [s]
   [w] (repeating this will overwrite the file with only one waveform)
   [W] (After the 10,000 events you can press it again to save 10,000 more and so on)
   [P] also [p]
   [T] also [t] 

   Please, take a time to understand the acquisition by playing around and making some plots before moving forward. Make sure you memorize the shortcuts.

   When pressing [W], my modifications will save 10,000 waveforms in the .dat files. When it finishes, you should see this in your screen: 

   [[https://github.com/hvsouza/CAEN_Digitizer/blob/master/.repo_img/continuous_ex.png]]

When you press [P] for continuous plot, what can happen is that gnuplot window will keep in your way (that is very annoying!). One way to stop this is to make sure that the plot is not over the windows you are trying to use, for example the terminal. If the windows are not overlapping you should be able to use the it normally. Another way is to enable “Prevent windows which require attention from stealing focus” (search this configuration for your Linux distribution). 

For using the GUI, the user should do the following during the acquisition:
Assuming you have [s] already running, user’s chosen setup done and triggering events.

[w] create a .dat file
[w] make sure you have created it (you can even press [w] once again. 
[W] save 10,000 or as many waveforms you want
- Move the .dat files by yourself or with GUI (see [[#using-the-gui]])
For acquire more data, repeat this. 

If you want to understand the binary file structure, please check [[#extra-file-structure]]. 

** Debugging USB

Some times, the digitizer will not be recognized by the computer (this usually happens after using different digitizers, usb devices or cables). One way to fix it:

Disconnect the digitizer, turn it off
#+begin_src bash
cd ~/Documents/ CAEN_Digitizer
./fix_usb.sh
#+end_src

Connect the digitizer and turn it on. Cross your fingers and try again. 



   
* QtCreator GUI
** Installation
** Creating the project
** Debugging installation
** Using the GUI

* Extra: Creating a shortcut for Wavedump
* Extra: Wavedump decreased sampling
* Extra: Common variables
* Extra: File structure
